function CallServer(c,b,a,f,g){if(typeof a.Ctrl!=="undefined")if($("#"+a.Ctrl).length&&$("#"+a.Ctrl).html().length===0){var e=$("#"+a.Ctrl),h=e.height();e.html("<center><img style='margin-top:"+h/2.2+"px;' src='/Content/images/ajax-loader.gif' alt='' /></center>")}$.ajax({type:"POST",url:f,beforeSend:function(d){d.setRequestHeader("Content-type","application/json; charset=utf-8")},data:c,contentType:"application/json; charset=utf-8",dataType:g,erorr:function(){alert("Nepavyko prisijungti..")},success:function(d){b(d,
a)}})}
function CallServer1(c,b){$.ajax({type:"POST",url:"TrackVehicle3.aspx/CallServer",beforeSend:function(a){a.setRequestHeader("Content-type","application/json; charset=utf-8")},data:c,contentType:"application/json; charset=utf-8",dataType:"json",erorr:function(a){$("#ImgWaiting").hide("slow");a.d=="Er_Saving"?alert("Nepavyko i\u0161saugoti duomen\u0173. \n Bandykite dar kart\u0105.."):alert(a.d)},success:function(a){$("#lblInfo").text("Duomenys gauti..").show();$("#ImgWaiting").hide("slow");if(b=="GetNewMap_Routes")if(a.d==
"")CallServer(c,b);else a.d=="'Empty'"?$("#lblInfo").text("Nerasta duomen\u0173..").show("slow"):GetNewMap_Routes(eval("("+a.d+")"));if(b=="GetNewMap_Pages_Routes")if(a.d=="")CallServer(c,b);else a.d=="'Empty'"?$("#lblInfo").text("Nerasta duomen\u0173..").show("slow"):GetNewMap_Pages_Routes(eval("("+a.d+")"));else if(b=="GetTable")if(a.d=="")CallServer(c,b);else if(a.d!="'Empty'"){TableArr=eval(a.d);FillTable(TableArr)}}})};

var oTable1="opa";$("input:text, textarea").live("focus",function(){$(this).hasClass("activeField")||$(this).addClass("activeField")}).live("blur",function(){$(this).removeClass("activeField")});jQuery.fn.center=function(){this.css("position","absolute");this.css("top",($(window).height()-this.height())/2+$(window).scrollTop()+"px");this.css("left",($(window).width()-this.width())/2+$(window).scrollLeft()+"px");return this};
$.fn.slideFadeToggle=function(a,b){return this.animate({opacity:"toggle",height:"toggle"},"fast",a,b)};function fnGetTodayDateString(){var a=new Date;return a.getFullYear()+"-"+(a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1)+"-"+(a.getDate()<9?"0"+a.getDate():a.getDate())}
function fnGetDateString(a){var b=new Date,c=b.getFullYear(),d=b.getMonth()+1,e=fn2No(b.getMonth()+1);b=fn2No(b.getDate());return a==="ThisYear"?c+".01.01":a==="Last6M"?(d<6?c-1:c)+"."+(d<6?fn2No(d+6):fn2No(d-6))+"."+b:a==="Last12M"?c-1+"."+e+"."+b:c+"."+e+"."+b}function fnGetDateString_noDay(a){var b=new Date,c=b.getFullYear(),d=b.getMonth()+1;b=fn2No(b.getMonth()+1);return a==="ThisYear"?c+".01":a==="Last6M"?(d<6?c-1:c)+"."+(d<6?fn2No(d+6):fn2No(d-6)):a==="Last12M"?c-1+"."+b:c+"."+b}
function fn2No(a){return a<10?"0"+a:a}function fnGetStringFromjDate(){var a=new Date(parseInt(jsonDate.substr(6)));return[a.format("yy/mm/dd"),a.format("HH:MM")]}
function fnGetDateTime(a){var b=/^(\d{4})[\-|\/|\.]?(\d{1,2})[\-|\/|\.]?(\d{1,2})[\s\S]*(\d{2}:\d{2})$/;if(a!=""){if(regs=a.match(b)){if(regs[3]<1||regs[3]>31){alert("Invalid value for day: "+regs[1]);return false}if(regs[2]<1||regs[2]>12){alert("Invalid value for month: "+regs[2]);return false}if(regs[1]<1902||regs[1]>(new Date).getFullYear()){alert("Invalid value for year: "+regs[3]+" - must be between 1902 and "+(new Date).getFullYear());return false}}else{alert("Invalid date format: "+a);return false}return regs[1]+
"-"+regs[2]+"-"+regs[3]+" "+regs[4]+":00"}}Array.prototype.FNameIndex=function(a){for(var b=0;b<this.length;b++)if(this[b].FName==a)return b;return""};Array.prototype.findIndexByVal=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return""};Array.prototype.findColsByID=function(a,b){for(var c=0;c<this.length;c++)if(this[c][0]===a)return typeof b==="object"?this[c].MapArrToString(b):this[c][b];return""};
Array.prototype.findRowByColValue=function(a,b){for(var c=0;c<this.length;c++)if(this[c][b]==a)return c;return""};Array.prototype.removeRowByID=function(a){for(var b=0;b<this.length;b++)if(this[b][0]===a){this.splice(b,1);return b}return""};Array.prototype.AddArray=function(a){for(var b=0;b<a.length;b++)this[this.length]=a[b]};Array.prototype.IndexOfFunc=function(a){for(var b=0;b<this.length;b++)if(a(this[b]))return b;return-1};
function ArrayIndexOf(a,b){if(!b||typeof b!="function")return-1;if(!a||!a.length||a.length<1)return-1;for(var c=0;c<a.length;c++)if(b(a[c]))return c;return-1}Array.prototype.ValueInMe=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return true;return false};Array.prototype.findColValByColVal=function(a,b,c){for(var d=0;d<this.length;d++)if(this[d][b]==a)return this[d][c];return""};Array.prototype.MapArrToString=function(a){for(var b=[],c=0;c<a.length;c++)b[b.length]=this[a[c]];return b.join(", ")};
Array.prototype.UpdateArrToNew=function(a){for(var b=0;b<this.length;b++)if(this[b][0]===a[0]){this[b]=a;return}};String.prototype.IsImage=function(){var a=this.substring(this.search("\\.")+1).toUpperCase();if(a==="PNG"||a==="JPG"||a==="GIF"||a==="JPEG"||a==="BMP")return true;return false};String.prototype.format=function(){for(var a=this,b=arguments.length;b--;)a=a.replace(RegExp("\\{"+b+"\\}","gm"),arguments[b]);return a};
String.prototype.GetIcon=function(a){var b="<span style='display:inline-block;' class='{0} ui-button-icon-primary'>",c="img32-Help";if(this.search("\\.")>0){var d=this.substring(this.search("\\.")+1).toLowerCase();b="<a href='/Uploads/"+a+"."+d+"' target='_blank'>"+b+"</a>";if(d==="png"||d==="jpg"||d==="gif"||d==="jpg"||d==="jpeg"||d==="bmp")c="img32-Img";else if(d==="xls"||d==="xlsx")c="img32-Excel";else if(d==="pdf")c="img32-Pdf";else if(d==="ppt"||d==="pptx")c="img32-ppt";else if(d==="doc"||d===
"docx")c="img32-Word"}else if(this==="Add")c="img32-"+this.toString();return b.format(c)};String.prototype.endsWith=function(a){return this.substr(this.length-a.length)===a};String.prototype.startsWith=function(a){return this.substr(0,a.length)===a};

var oCONTROLS={lbl:function(a){return"<label class='dialog-form-label'>"+a+"</label>"},AddToProperty:function(a,b,c){a[b]=a[b]?a[b]+" "+c:c;return a},basic:function(a){return(a.attr?a.attr+" ":"")+(a.id?"id='"+a.id+"' ":"")+(a.style?'style="'+a.style+'" ':"")+(a.notabstop?"tabindex='-1' ":"")+(a.title?"title='"+a.title+"' ":"")+(a.data_ctrl?"data-ctrl='"+a.data_ctrl+"' ":"")+(a.classes?"class='"+a.classes+"' ":"")},appendLabel:function(a,b){if(!a.label)return b;if(!a.label.txt||a.label.type==="None")return b;
return typeof a.label==="undefined"||a.label==="None"?b:a.label.type==="Top"?"<label class='toplabel'><span>"+a.label.txt+"</span>"+b+"</label>":"<label class='leftlabel'><span>"+a.label.txt+":</span>"+b+"</label>"},txt:function(a){return this.appendLabel(a,"<input type='text' "+this.basic(a)+(a.Value?'value="'+a.Value+'" ':"")+"/>")},hidden:function(a){return this.appendLabel(a,"<input type='hidden' "+this.basic(a)+(a.Value?'value="'+a.Value+'" ':"")+"/>")},a:function(a){return"<a "+this.basic(a)+
" href='javascript:void(0);return false;'>"+a.Value+"</a>"},txtarea:function(a){return this.appendLabel(a,"<textarea cols='100' rows='4' "+this.basic(a)+">"+(a.Value?a.Value:"")+"</textarea>")},chk:function(a){if(typeof a.Value==="string")a.Value=a.Value.search(/false/i)>-1?0:1;return"<label "+(a.label.classes?" class='"+a.label.classes+"'":"")+(a.attr?a.attr+" ":"")+"><input type='checkbox' "+this.basic(a)+(a.Value?"checked='checked'":"")+"/>"+(a.label.txt?a.label.txt:"")+"</label>"},img:function(a){return"<img src='"+
a.src+"' alt='"+a.alt+"' onclick='"+a.onclickfn+"'/>"},ui_img:function(a){return"<span class='ui-icon "+a.name+"' style='"+a.style+";margin-top:.5em;' onclick=\""+a.onclickfn+'"/>'},txt_imgINtxt:function(a,b,c){b.classes=b.classes?b.classes+" InputInWraper":"InputInWraper";var d="width:"+(a.width-20)+"px;";b.style=b.style?b.style+d:d;return"<div "+this.basic(a)+"width:"+a.width+"px;'>"+this.txt(b)+this.ui_img(c)+"</div>"},btnOKimg:function(a){return"<button tabindex='-1' title='"+a+"' class='ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-all ui-button-icon' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-circle-check'></span><span class='ui-button-text'>&nbsp;</span></button></div>"},
lbltxt_inline_btnConfirm:function(a,b,c,d,f){return"<div id="+a+"><label class='dialog-form-r'>"+b+"</label><input type='text' data-ctrl=\""+c+"\" value='"+d+"' class='validate-dialog ui-widget-content ui-corner-left'/><button tabindex='-1' title='"+f+"' class='ui-button ui-widget ui-state-default ui-button-icon-only ui-corner-right ui-button-icon' role='button'><span class='ui-button-icon-primary ui-icon ui-icon-circle-check'></span><span class='ui-button-text'>&nbsp;</span></button></div>"},lbla_inline:function(a,
b,c,d){return"<div id="+a+"><label class='dialog-form-label'>"+b+'</label><a data-ctrl="'+d+"\" href='javascript:void(0);'>"+c+"</a></div>"},btnTextOnly:function(a){oCONTROLS.AddToProperty(a,"classes","ui-button ui-corner-all ui-button-text-icon-primary");return"<button "+oCONTROLS.basic(a)+'" role="button"><span class="ui-button-text">'+a.text+"</span></button>"},btnImgOnly:function(a){oCONTROLS.AddToProperty(a,"classes","ui-button ui-corner-all ui-icon-only");return"<button "+oCONTROLS.basic(a)+
'" role="button"><span class="ui-button-icon-primary ui-icon '+a.icon+'"></span></button>'},btnTextImg:function(a){oCONTROLS.AddToProperty(a,"classes","ui-button ui-corner-all ui-button-text-icon-primary");return"<button "+oCONTROLS.basic(a)+'" role="button"><span class="ui-button-icon-primary ui-icon '+a.icon+'"></span><span class="ui-button-text">'+a.text+"</span></button>"},OptionList:function(a){for(var b="<select id='"+a.id+"' name= id='"+a.id+"'>",c=0;c<a.Arr.length;c++){for(var d=[],f=0;f<
a.TextI.length;f++)d.push(a.Arr[c][a.TextI[f]]);if(typeof a.ReplaceArr!="undefined")for(f=0;f<a.ReplaceArr.length;f++)for(var e=a.ReplaceArr[f].obj.Data,i=a.ReplaceArr[f].Ix,g=a.ReplaceArr[f].txtIx,h=0;h<e.length;h++)if(d[i]===e[h][0]){d[i]=e[h][g];break}d=d.join(", ");b+=a.SelectedID?'<option value="'+a.Arr[c][a.ValI]+(+a.Arr[c][0]==a.SelectedID?'" selected="selected"':'"')+">"+d+"</option>":'<option value="'+a.Arr[c][a.ValI]+'">'+d+"</option>"}return b+"</select>"},UpdatableForm_toSaved:function(a,
b){if(a){$.extend(b.data("ctrl"),{NewRec:0,id:a});b.find("span.Control, div.Control").each(function(){var c=$(this),d=c.data("ctrl");if(d.Control==="swfUpload"&&c.children().length===0){$.extend(c.data("ctrl"),{RecId:a});c[d.Control](c.data("ctrl"))}})}b.find(".UpdateField").each(function(){var c=$(this);c.data("ctrl");var d;d=c.attr("type")==="checkbox"?c.attr("checked")?1:0:c.is("textarea")?c.html():c.is("input")&&c.data("ctrl").Type==="List"?c.data("newval"):c.val();$.extend(c.data("ctrl"),{Value:d})})},
UpdatableForm:function(a){var b="",c=$(a).data("ctrl"),d=c.Source==="NoData"?"NoData":oDATA.Get(c.Source);$(a).find("div.ExtendIt, span.ExtendIt");$(a).find("div.ExtendIt, span.ExtendIt").each(function(){var f=$(this),e=f.data("ctrl"),i="",g=-1,h={};if(typeof e.Control!=="undefined"){e.Control==="swfUpload"&&typeof c.id==="undefined"||f[e.Control](e);return true}if(d!=="NoData"){var n=d.Cols;if(e.Field){for(var o=0;o<n.length;o++)if(n[o].FName===e.Field){g=o;b=d.Grid.aoColumns[o].sTitle;break}g===
-1&&alert("Wrong Field indicated "+e.Field+" in UpdatableForm(objFunc:84)!")}}b=e.sTitle?e.sTitle:b;g=d==="NoData"?{}:d.Cols[g];var j;g=$.extend(g,e);e=g.List?"List":g.Type;if(!e){alert("Nesusiparsino ctrl elemento objFunc.js-UpdatableForm");return true}n="ui-widget-content ui-corner-all";n+=f.hasClass("NotUpdateField")?" NotUpdateField":" UpdateField";if(e==="Integer"||e==="Decimal")n+=" number";else if(e==="List")g.Type="List";else if(e)if(e.search("Date")!==-1)n+=" date";g.classes=g.classes?g.classes+
" "+n:n;g.Value=g.Value?g.Value:"";for(var m in g)if(m==="List"){$.extend(h,g[m]);h.Type="List"}else if(m==="Value"||m==="Validity"||m==="AgrValidity"||m==="Tip"||m==="Field"||m==="Type"||m==="Ext"||m==="UpdateField")h[m]=g[m];h=JSON.stringify(h);if(e==="Integer"||e==="Decimal")h=h.replace("match('integer')","match(integer)").replace("match('number')","match(number)");else if(e.search("Date")!==-1)h=h.replace("match('date')","match(date)");$.extend(g,{data_ctrl:h},{label:{txt:b,type:g.labelType}});
if(e==="List"){i+=oCONTROLS.txt(g);j=$(i).prependTo(f).parent().find("input").ComboBox()}else if(e==="Boolean"||e==="checkbox"){i=oCONTROLS.chk(g);$(i).prependTo(f)}else if(e==="String"||e==="Email"||e==="text"||e==="textarea"||e==="hidden"){var l=typeof g.LenMax==="undefined"?0:g.LenMax;if(e==="hidden"){i+=oCONTROLS.hidden(g);j=$(i).prependTo(f).parent().find("input:first")}else if(l<101&&e!=="textarea"){i+=oCONTROLS.txt(g);j=$(i).prependTo(f).parent().find("input:first")}else{i+=oCONTROLS.txtarea(g);
j=$(i).prependTo(f).parent().find("textarea:first")}}else if(e==="Integer"||e==="Decimal"){i+=oCONTROLS.txt(g);j=$(i).prependTo(f).parent().find("input").ValidateOnBlur({Allow:e})}else if(e.search("Date")!==-1){h=0;if(!g.Value&&g.Default==="Today")g.Value=fnGetTodayDateString();if(e.search("Time")!==-1){l=g.Value.length>=16?g.Value.substring(11,16):"00:00";h=1}g.Value=g.Value.substring(0,11);i+=oCONTROLS.txt(g);if(h)i+=oCONTROLS.txt({text:l,style:"margin-left:20px;",title:"Laikas",classes:"time ui-widget-content ui-corner-all"});
j=$(i).prependTo(f).parent().find("input:first");j.ValidateOnBlur({Allow:"date"})}g.Plugin&&$.each(g.Plugin,function(k,p){j[k](p)});if(typeof j!=="undefined"){j.val($.trim(j.val()));typeof g.Tip!=="undefined"&&j.labelify({labelledClass:" inputTip ",text:function(k){return $(k).data("ctrl").Tip}})}})},Set_Updatable_HTML:{mega_select_list:function(a){var b="<p tabindex='0' class='rowHeight' style='background-color:#d3d1ba;margin-top:0px;font-weight:bold;'>"+a.opt.SelectText+"<span style='margin-left:10px;cursor:pointer;color: #3366CC;text-decoration: underline;'></span><a id='aCancelSelectOpt' class='floatright' href='#'>At\u0161aukti</a><div class='clearfix'></div></p>";
b+="<div class='megaselectlistoptions'>";for(var c="",d=0;d<a.oDATA.Data.length;d+=3){c+="<div class='megaselectlistcolumn'><ul>";c+="<li 'tabindex=-1' data-val="+a.oDATA.Data[d][a.opt.val]+">"+a.oDATA.Data[d][a.opt.text]+"</li>";c+="<li 'tabindex=-1' data-val="+a.oDATA.Data[d+1][a.opt.val]+">"+a.oDATA.Data[d+1][a.opt.text]+"</li>";c+="<li 'tabindex=-1' data-val="+a.oDATA.Data[d+2][a.opt.val]+">"+a.oDATA.Data[d+2][a.opt.text]+"</li></ul></div>"}b+=c+"<div style='clear: both;'></div></div></hr>";$(a.ctrl).append(b);
b=a.ctrl.find("div.megaselectlistoptions");b.data("height",b.height());a.ctrl.find("a.floatright").bind("click",function(){a.fnCancel();return false});a.ctrl.find("li").bind("click",function(){$("#aCancelSelectOpt").remove();li=$(this);a.ctrl.find("span:eq(0)").html(li.html());a.ctrl.data("ctrl")[a.opt.FieldName]=li.data("val");a.ctrl.attr("data-ctrl",JSON.stringify(a.ctrl.data("ctrl")));typeof a.fnAfterOptClick=="function"&&a.fnAfterOptClick($(this));a.ctrl.find("div.megaselectlistoptions").height("0px")});
a.ctrl.find("span").bind("click",function(){var f=a.ctrl.find(".megaselectlistoptions");f.height()==0?f.animate({height:f.data("height")+"px"}):f.animate({height:"0px"})})},lbltxt_inline_btnConfirm:function(a){a.ctrl.html(oCONTROLS.lbl(a.lblTitle)+oCONTROLS.txt(a.txt.Title,a.txt.Value,'{"Validity":"'+a.Data.Validity+'"}')+oCONTROLS.btnOKimg(a.btnTitle));typeof a.fnPostInit!="undefined"&&a.fnPostInit();a.ctrl.find("button").bind("click",function(b){b.preventDefault();if(oGLOBAL.ValidateCtrlsArr([a.ctrl.find("input")])){a.DataToSave.Data[0]=
a.ctrl.find("input").val();oGLOBAL.UpdateServer("Edit",a.DataToSave,a.Data.tblToUpdate,a.fnCallBack,"")}a.ctrl.block("Siun\u010diami duomenys..");return false})},lbla_inline:function(a){a.ctrl.html(oCONTROLS.lbla_inline("divID"+a.DataToSave.id,a.lblTitle,a.Value,""));a.ctrl.find("a").bind("click",function(b){b.preventDefault();oGLOBAL.UpdateServer("Edit",a.DataToSave,a.Data.tblToUpdate,a.fnCallBack,"");a.ctrl.block("Siun\u010diami duomenys..");return false})}}},oGLOBAL={temp:{},map:{},someProperty:"some value here",
GetURL:function(a){a=oGLOBAL.GetNo(a);var b=location.pathname.split("/");LastI=b[length-1];LastI=oGLOBAL.GetNo(LastI);b.pop();b=b.join("/");a<0?location.replace(b+"/"+(LastI-1)):location.replace(b+"/"+a)},GetNo:function(a){if(!oVALIDATE.IsNumeric(a))return 0;a=/\d+/.exec(a);return a[0]?a[0]:0},GetPar:function(){var a=location.pathname.split("/");a=a[a.length-1];if(!oVALIDATE.IsNumeric(a))return 0;return oGLOBAL.GetNo(a)},UpdateServer:function(a){a.BlockCtrl&&a.BlockCtrl.block({message:"Siun\u010diami duomenys.."});
var b="/Update/"+a.Action;CallServer(JSON.stringify(a.DataToSave),this.fnServerUpdated,a,b,"json")},fnServerUpdated:function(a,b){b.BlockCtrl&&b.BlockCtrl.unblock();var c=b.Msg.Title?b.Msg.Title:"Duomen\u0173 keitimas.",d;DefMsg={Error:{Add:"Nepavyko i\u0161saugot nauj\u0173 duomen\u0173.",Edit:"Nepavyko pakeisti duomen\u0173.",Delete:"Nepavyko i\u0161trinti duomen\u0173."},Success:{Add:"Duomenys s\u0117kmingai prid\u0117ti.",Edit:"Duomenys s\u0117kmingai pakeisti.",Delete:"Duomenys i\u0161trinti."}};
d=$.extend({},DefMsg,b.Msg);if(a.ErrorMsg){d=d.Error[b.Action];d+=" Klaida:\n"+a.ErrorMsg;typeof b.CallBack.Error==="function"&&b.CallBack.Error(a);DIALOG.Alert(d,c)}else{d=d.Success[b.Action];typeof b.CallBack.Success==="function"&&b.CallBack.Success(a,b);$.growlUI(c,d)}return false},ValidateCtrlsArr:function(a){$.validity.start();for(var b=0;b<a.length;b++){var c=a[b].data("ctrl").Validity;eval("CtrlsArr[i]."+c)}return $.validity.end()},ValidateForm:function(a,b){$("div.validity-modal-msg").remove();
var c=a.data("ctrl"),d=c.id,f=parseInt(c.NewRec,10);c=c.tblUpdate?c.tblUpdate:oDATA.Get(c.Source).Config.tblUpdate;!d&!f&&alert("N\u0117ra nurodyta id formos data(ctrl)!");$.validity.setup({outputMode:"modal"});$.validity.start();var e={Data:[],Fields:[],DataTable:c};$.each(a.find(".UpdateField"),function(i,g){log("---------------------------");var h=$(g),n=h[0].tagName+", id-"+h.attr("id"),o=h.data("ctrl").UpdateField?h.data("ctrl").UpdateField:false;if(h.data("ctrl")===undefined){alert("Nerasta data(ctrl),el: "+
n);return true}log("OK,el: "+n);var j;n=h.data("ctrl").Field;var m=f?"":h.data("ctrl").Value,l="";if(h.attr("type")==="checkbox")l=h.attr("checked")?1:0;else{if(typeof h.data("ctrl").Type==="undefined")log("<div style='color:red'>Nerastas elemento Tipas!</div>");else{j=h.data("ctrl").Type;var k=h.data("ctrl").Validity?h.data("ctrl").Validity:"";if(j==="hidden")l=h.val();else if(j.substring(0,4)=="Date"){k=k.replace(/match\(date\)/g,"match('date')");l=h.val();eval("e."+k);if(j.search(/time/i)>-1){k=
h.parent().next();k.match(/^\d{2}[:]\d{2}$/,"Laikas turi b\u016bt sekan\u010dio formato - valandos:minut\u0117s");l=l+" "+k.val()+":00"}}else if(j==="List")if(h.data("newval"))l=h.data("newval");else{h.val("");h.require("Reikalinga parinkti reik\u0161m\u0119 i\u0161 sara\u0161o..")}else{var p=h.data("ctrl").Tip?h.data("ctrl").Tip:"",q=false;if(p&&p===h.val()){h.val("");q=true}if(j==="Decimal"||j==="Integer"){h.val(h.val().replace(/,/g,"."));k=k.replace(/match\(number\)/g,"match('number')").replace(/match\(integer\)/g,
"match('integer')")}l=h.val();var r=d?m!=l?true:false:true,s=k.search(/require/i)>-1,t=l===""?false:true;if(r&&(s||t))k&&eval("e."+k);q&&h.val(p)}}if(typeof h.data("ctrl").AgrValidity!=="undefined"){k=h.data("ctrl").AgrValidity;k.Validity==="require"&&$.map($(k.Selector),function(u){return $(u).val()?null:1}).length===$(k.Selector).length&&h.require(k.Msg)}}if(m!=l||l===0&&m===""){if(o)e[o]=l;else{e.Data.push(l);e.Fields.push(n)}log("Save element: val-"+l+", OldVal-"+m+", Type-"+j)}});if(typeof b!=
"undefined")for(c=0;c<b.length;c++){e.Data.push(b[c].Data);e.Fields.push(b[c].Fields)}c=$.validity.end();if(c.valid&&e.Data.length){f||(e.id=d);return e}else return c.valid?0:false},Validate:{IsNumeric:function(a){if(/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)/.test(a))return true;return false}}},oVALIDATE={IsNumeric:function(a){if(/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)/.test(a))return true;return false},IsYear:function(){},Element:function(a,b){$.validity.start();if(!b)return true;eval("$(Element)."+
b);return $.validity.end()}},TIMEDIF={s:0,Start:function(){this.s=(new Date).getTime()},log:function(a){dif=(new Date).getTime()-this.s;console.log((a?a:"")+" - "+dif+" msek");this.s=(new Date).getTime()}};
function exec_GetTableHTML(a){var b=function(c,d){for(var f=[],e=0;e<c;e++)if($.inArray(e,d)===-1)f[f.length]=e;return f}(a.Head.length,a.Config.NotVisibleCol);return"<table id='DataGrid'  class='display'>"+function(c,d){for(var f="",e=0;e<d.length;e++)f+="<th>"+c[d[e]]+"</th>";return"<thead><tr>"+f+"</tr></thead>"}(a.Head,b)+function(c,d){for(var f="",e=0;e<c.length;e++){f=f;for(var i="",g=0;g<d.length;g++)i+="<td>"+c[e][d[g]]+"</td>";f=f+("<tr>"+i+"</tr>")}return"<tbody>"+f+"</tbody>"}(a.Data,b)+
"</table>"}
function exec_GetULListHTML(a){function b(f,e){for(var i="",g=0;g<e.length;g++)i+='<li class="lact" id="limnu_'+f+e[g][0]+'"><a href="#" onclick="MenuClick(\''+f+"',"+e[g][0]+',this.id);return false;">'+e[g][1]+"</a></li>";return i}for(var c="",d=0;d<a.length;d++)if(a[d][1].length==0)c+='<li class="lact" id="limnu_'+d+'"><a href="#" onclick="MenuClick(\''+a[d][0]+"',0,'limnu_"+d+"');return false;\">"+a[d][0]+"</a></li>";else{c+='<li class="ltitle"><a>'+a[d][0]+"</a>";c+="<ul>"+b(a[d][0],a[d][1])+
"</ul></li>"}return"<ul>"+c+"</ul>"}
function exec_GetOptionListHTML(a){for(var b="<select id='"+a.id+"'>",c=0;c<a.Arr.length;c++){for(var d=[],f=0;f<a.TextI.length;f++)d.push(a.Arr[c][a.TextI[f]]);if(typeof a.ReplaceArr!="undefined")for(f=0;f<a.ReplaceArr.length;f++)for(var e=a.ReplaceArr[f].obj.Data,i=a.ReplaceArr[f].Ix,g=a.ReplaceArr[f].txtIx,h=0;h<e.length;h++)if(d[i]===e[h][0]){d[i]=e[h][g];break}d=d.join(", ");b+=a.SelectedID?"<option value='"+a.Arr[c][a.ValI]+(+a.Arr[c][0]==a.SelectedID?"' selected='selected'":"'")+">"+d+"</option>":
"<option value='"+a.Arr[c][a.ValI]+"'>"+d+"</option>"}return b+"</select>"};

(function(){var b,t=function(e,o){return function(){return e.apply(o,arguments)}};b=jQuery;b.fn.clsGrid=function(e,o){var q,s,j,k;s=0;j=oDATA.Get(o);b(this).length>1&&alert("Daugiau nei vienas objektas ant kurio dedamas gridas!");j=b.extend(j.Grid,{aaData:j.Data});e.Header&&b.extend(j,{fnHeaderCallback:function(c){var a,d,g,h,n,f,m;if(s++===0){a=function(){return h.find("th span").removeClass("ui-icon-triangle-1-n ui-icon-triangle-1-s ui-icon-carat-2-n-s").addClass("ui-icon-carat-2-n-s")};f=b(c).css("line-height",
"0.9em");d=m=n=0;g=f.find("th").length;for(h=f.clone(true,true);d<g;){c=e.Header.findRowByColValue(d,"col");if(c!==""){f.find("th:eq("+(d-m)+")").attr("colspan",e.Header[c].span).css("text-align","center").html(e.Header[c].Name).next().remove();d+=e.Header[c].span-1;m++}else{f.find("th:eq("+(d-m)+")").attr("rowspan",2);h.find("th:eq("+(d-n)+")").remove().end().find("th").click(function(i){var l;i=b(i.target).find("span:first");if(i.hasClass("ui-icon-carat-2-n-s"))l="ui-icon-triangle-1-n";else if(i.hasClass("ui-icon-triangle-1-n"))l=
"ui-icon-triangle-1-s";else if(i.hasClass("ui-icon-triangle-1-s"))l="ui-icon-triangle-1-n";a();return i.addClass(l).removeClass("ui-icon-carat-2-n-s")});n++}d++}return f.click(a).after(h)}}});e.Groups&&b.extend(j,{fnDrawCallback:function(c){var a,d,g,h,n,f,m,i,l,p;i=b(c.nTBody).find("tr");if(!(i.length<2)){n=i[0].getElementsByTagName("td").length;p="";g=-1;h=0;for(a=function(r){r=parseInt(r,10);return oDATA.Get(e.Groups.GroupCaption.Tbl).Data.findColsByID(r,e.Groups.GroupCaption.ShowCols)};h<i.length;){f=
c._iDisplayStart+h;g++;l=c.aoData[c.aiDisplay[f]]._aData[e.Groups.ColToGroup];if(l!==p){m=document.createElement("tr");f=document.createElement("td");f.colSpan=n;f.className="group";f.innerHTML=a(l);m.appendChild(f);i[h].parentNode.insertBefore(m,i[h]);if(p){d.innerHTML+=" ("+g+"vnt.)";g=0}p=l;d=f}h++}return d.innerHTML+=" ("+(g+1)+"vnt.)"}}});b.extend(true,j,{fnInitComplete:function(c){return c.fnRowCallback=null},oLanguage:{sLengthMenu:"Rodyti _MENU_ ir. psl.",sZeroRecords:"Nerasta ira\u0161u..",
sInfo:"Viso: _TOTAL_",sInfoEmpty:"Rodoma: 0 - 0 i\u0161 0 ira\u0161u",sInfoFiltered:"(Filtruota i\u0161 _MAX_ ira\u0161u)",sSearch:"Ie\u0161koti:"},sProcessing:"Laukite..",bJQueryUI:true,bSortClasses:false,bPaginate:false,sScrollX:"100%",bScrollCollapse:false,clickEvtIsLive:1,colorAfterNewInsert:1},e);k=b(this).dataTable(j);setTimeout(t(function(){b(k).css("width","100%");return k.fnDraw()},this),100);if(e.fnEditRowOnClick){j=function(){var c;c={objData:o,Action:"Edit",ClickedRow:this,aRowData:k.fnGetData(k.fnGetPosition(this))};
c.CallBackAfter=function(a){var d;d=k.fnGetPosition(c.ClickedRow);return k.fnUpdate(a,d,0)};return new clsEditableForm(c)};b(this).find("tbody tr").bind("click",j)}if(e.GridButtons){q=b(this).parent().parent().parent().find("div:first");b.each(e.GridButtons,function(c,a){var d;d=a.icon?{icons:{primary:a.icon}}:{};return b('<button class="AddNew" title='+c+">"+c+"</button>").button(d).click(function(g){a.objData=o;if(g.target){a.target=b(g.target).is("button")?b(g.target):b(g.target).parent();b(a.target).css("display",
"none")}if(a.form==="Head")a.form=b("<div></div>").insertAfter(q).css("margin-bottom","10px");if(a.Action==="Add"){a.aRowData=0;a.CallBackAfter=function(h){return k.fnAddData(h)};return new clsEditableForm(a)}else return a.Action(a)}).appendTo(q)})}return k}}).call(this);

(function(){var e,i,j,k,h,g;g={};this.My={};j=$("#header div.subHeader a.highlight").data("controller");e="";$(function(){k();return $("#side-bar li>a").first().trigger("click")});k=function(){return $("#side-bar").on("click","li>a",function(){var a,c,b;$("body").addClass("wait");$("#side-bar a.highlight").removeClass("highlight");$(this).addClass("highlight");(a=$(this).data("Par")?JSON.stringify($(this).data("Par")):"")&&$(this).data("opt","refresh");window.oGLOBAL.Action=$(this).data("action");
if($(this).data("opt")==="refresh"){c=true;$(this).data("opt","ok")}else c=false;b="/"+j+"/"+(e=$(this).data("action"));g[e]&&!c?h(g[e][0]):i(b,a);return $("body").removeClass("wait")})};i=function(a,c,b){if(b==null)b=$("#main-copy");b.parent().block();return $.ajax({url:a,type:"POST",data:c,dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(d){return d.setRequestHeader("Content-type","application/json; charset=utf-8")},error:function(){b.html("<center><h2>\u0160i dalis dar nebaigta("+
e+")</h2><img src='/Content/images/UnderConstruction.gif' alt=''/></center>");return b.parent().unblock()},success:function(d){h(d,b);if(g[e])g[e].push(d);else g[e]=[d];b.parent().unblock();return false}})};h=function(a,c){var b;if(c==null)c=$("#main-copy");a.Render&&c.empty().html(a.Render);for(b in a)b!=="Render"&&b!=="Script"&&!oDATA.Get[b]&&this.oDATA.Set(b,a[b]);if(e==="Clients_NewClient")return Clients_NewClient();else if(e==="MyEvents")return Title_MyEvents();else if(e==="ClientsList")return Clients_ClientsList_Grid();
else if(a.Script){a.Script.File&&$.getScript(a.Script.File);if(a.Script.oSCRIPT)return this.oSCRIPT=a.Script.oSCRIPT}else return My[e]()};Array.prototype.remove=function(a){var c;if((a=this.indexOf(a))>-1)return[].splice.apply(this,[a,a-a+1].concat(c=[])),c};this.oDATA={Obj:{},Set:function(a,c){return this.Obj[a]=c},Get:function(a){return this.Obj[a]},UpdateRow:function(a,c,b){if(b==="Edit"){this.GetRow(a[0],c);return a}else if(b==="Add")return this.GetData(c).push(a);else if(b==="Delete")return this.GetData(c).remove(a)},
GetRow:function(a,c){var b,d,f;b=this.GetData(c);d=b.length-1;for(f=-1;f<d;){f++;if(b[f][0]===a)return b[f]}},GetData:function(a,c){return typeof a==="string"?c?this.Obj[a].Cols:this.Obj[a].Data:a.Data},GetStringFromIndexes:function(a,c,b){return this.GetRow(a,c).MapArrToString(b)},UpdateCell:function(a,c,b,d,f){var l;l=typeof d==="number"?d:oDATA.Get(a).Cols.FNameIndex(d);typeof d==="number"&&c&&alert("Updatinimui reikalingas lauko pavadinimas");this.GetRow(b,a)[l]=f;if(c)return $.post("/Update/editInPlace",
{id:b,tbl:c,update_value:f,field:d})}}}).call(this);

var DIALOG=new clsDialogUi;$(document).ready(function(){$("#dialog:ui-dialog").dialog("destroy");$(".selector").click(function(){DIALOG.NewRecord(CallThisBack)})});
function clsDialogUi(){this.Alert=function(c,a){d.title=a;$("<div></div>").html(c).dialog(d).dialog("open");$(this)};this.NewRecord=function(c){var a='<p class="validateTips">All form fields are required.</p>';a+='<form id="dialog-form-validate">';a+="<fieldset>";a+='<label for="thename">Name</label>';a+='<input type="text" name="thename" id="thename" class="validate-dialog text ui-widget-content ui-corner-all" />';a+='<label for="email">Email</label>';a+='<input type="text" name="email" id="email" value="" class="validate-dialog text ui-widget-content ui-corner-all" />';
a+='<label for="password">Password</label>';a+='<input type="password" name="password" id="password" value="" class="validate-dialog text ui-widget-content ui-corner-all" />';a+="</fieldset>";a+="</form>";this.CallBack=c;DIALOG.result=0;$("<div></div>").html(a).dialog(e).dialog("open");return false};this.Confirm=function(c,a,f){b.title=a;this.CallBack=f;DIALOG.result=0;$("<div></div>").html(c).dialog(b).dialog("open")};var b={autoOpen:false,height:"auto",width:350,modal:true,buttons:{Patvirtinti:function(){DIALOG.result=
1;$(this).dialog("close")},"At\u0161aukti":function(){DIALOG.result=0;$(this).dialog("close")}},close:function(){DIALOG.result===1&&DIALOG.CallBack&&DIALOG.CallBack()}},e={autoOpen:false,height:"auto",width:465,modal:true,buttons:{"I\u0161saugoti":function(){DialogInputsAreValid($("#dialog-form-validate"))&&$(this).dialog("close")},"At\u0161aukti":function(){DIALOG.result=0;$(this).dialog("close")}},close:function(){if(DIALOG.result===1){DIALOG.CallBack();alert("jo")}$(this).remove();$(".validity-modal-msg").remove()}},
d={autoOpen:false,minHeight:200,width:400,modal:true,buttons:{Gerai:function(){$(this).dialog("close")}}}}
function DialogInputsAreValid(b){var e=/'number'/;$.validity.setup({outputMode:"modal"});$.validity.start();$(b).children().find(".validate-dialog").each(function(){var d=$(this);e.test("require().match('number').lessThanOrEqualTo(100)")&&d.val(d.val().replace(/,/g,"."));eval("child.require().match('number').lessThanOrEqualTo(100)")});b=$.validity.end();DIALOG.result=b.valid?1:0;return b.valid};

(function(){this.clsEditableForm=function(){function m(c){var h,i,j,f;$("body").css("cursor","wait");b.Title=0;$.extend(b,c);o=b.aRowData!=null?b.aRowData[0]:0;e=oDATA.Get(b.objData);k=b.Action;e==null&&alert("Neradau objekto "+b.objData+" clsEditableForm klaseje");a={Cols:e.Cols,Grid:e.Grid,Data:b.aRowData};if(o&&a.Data==null){f=e.Data;i=0;for(j=f.length;i<j;i++){c=f[i];if(c[0]===o){a.Data=c;break}}}if(!b.Title){d=e.Config;b.Title=k==="Add"?d.Msg.AddNew:d.Msg.Edit;if(d.Msg.AddToTitle&&k==="Edit"){c=
function(){var l,p,q,r;q=d.Msg.AddToTitle;r=[];l=0;for(p=q.length;l<p;l++){h=q[l];r.push(a.Data[h])}return r}();b.Title+=" - "+c.join(" ")}}this.fnLoadEditableForm();$("body").css("cursor","default")}var k,d,a,g,n,o,e,b;o=0;e={};d={};a={};e={};k={};b={DialogFormId:"divDialogForm",fnAddNewForm:"Dialog",CallBackAfter:0,aRowData:0};m.prototype.fnLoadEditableForm=function(){var c,h,i;if(!b.form||b.form==="Dialog"){c={autoOpen:false,minWidth:"65em",minHeight:"40em",width:"80em",modal:true,title:b.Title,
draggable:true,buttons:{"I\u0161saugoti pakeitimus":function(){return n()},"I\u0161trinti":function(){return $(this).dialog("close")},"At\u0161aukti":function(){return $(this).dialog("close")}},close:function(){return $(this).remove()},dragStart:function(){return $("div.validity-modal-msg").remove()}};i=b.RenderHTML?b.RenderHTML:this.fnGenerateHTML(a,o);$("#dialog:ui-dialog").dialog("destroy");$("<div id='"+b.DialogFormId+"'></div>").html(i).dialog(c).dialog("open")}else{i=b.RenderHTML?b.RenderHTML:
this.fnGenerateHTML(a,o);$(i).append('<button style="float:right;" title="At\u0161aukti">At\u0161aukti</button>').find("button:last").button().click(function(){return g()}).end().append('<button style="float:right;" title="I\u0161saugoti">I\u0161saugoti</button>').find("button:last").button().click(function(){return n()}).end().appendTo(b.form).append('<div style="clear:both;"></div>').prepend("<h3>"+b.Title+"</h3>")}oCONTROLS.UpdatableForm($("#divEditableForm"));h=$("#"+b.DialogFormId).parent();
h.find("button:contains('I\u0161saugoti')").attr("disabled","disabled").addClass("ui-state-disabled");h.find("input, textarea").bind("click keyup",function(){return h.find("button:contains('I\u0161saugoti')").removeAttr("disabled").removeClass("ui-state-disabled")});h.find("div.ExtendIt button").click(function(){return h.find("button:contains('I\u0161saugoti')").removeAttr("disabled").removeClass("ui-state-disabled")});return h.find("button:contains('I\u0161trinti')").css("display","none")};g=function(){b.target&&
b.target.css("display","block");return b.form.empty()};n=function(){var c;if(c=oGLOBAL.ValidateForm($("#divEditableForm")))return oGLOBAL.UpdateServer({Action:k,DataToSave:c,CallBack:{Success:function(h,i){var j,f,l,p,q;l=a.Cols.length;f=0;p=i.DataToSave.Fields.length;if(k==="Add"){a.Data=Array(l);a.Data[0]=h.ResponseMsg.ID}for(;f<l-1;){j=q=0;for(f++;q<p;){if(a.Cols[f].FName===i.DataToSave.Fields[q]){a.Data[f]=i.DataToSave.Data[q];j=1;break}q++}if(!j&&k==="Add")if(a.Cols[f].Default!=null)a.Data[f]=
a.Cols[f].Default==="Today"?fnGetTodayDateString():a.Cols[f].Default==="UserName"?UserData.Name():a.Cols[f].Default==="UserId"?UserData.Id():a.Cols[f].Default;else if(a.Cols[f].UpdateField){j=a.Cols[f].UpdateField;a.Data[f]=i.DataToSave[j]}else a.Data[f]="";if(a.Data[f]===null)a.Data[f]=""}for(f=0;f<l-1;){f++;if(a.Cols[f].IdInMe){j=a.Cols[f].IdInMe;o=a.Data[j];p=a.Cols[j].List.Source;j=a.Cols[j].List.iText;a.Data[f]=oDATA.GetStringFromIndexes(o,p,j)}}oDATA.UpdateRow(a.Data,e,k);b.CallBackAfter&&b.CallBackAfter(a.Data);
return!b.form||b.form==="Dialog"?$("#"+b.DialogFormId).dialog("close"):g()}},Msg:"",BlockCtrl:$("#divEditableForm")});else if(c===0)return $("#"+b.DialogFormId).dialog("close")};m.prototype.fnGenerateHTML=function(c,h){var i,j,f,l,p;j=c.Cols.length;l=0;for(f="";l<j;){i="";if(c.Grid.aoColumns[l].sTitle!=null){if(c.Data[l]!=null&&c.Data[l]){p=c.Cols[l].Type?c.Cols[l].Type:"";p=p==="String"||p==="Email"||p.substring(0,4)==="Date"?'"'+c.Data[l].replace(/"/g,"\\u0027")+'"':c.Data[l]}else p='""';i+='"Value":'+
p+",";f+="<div class='ExtendIt' data-ctrl='{"+i+'"Field":"'+c.Cols[l].FName+'","classes":"UpdateField","labelType":"Left"}\'></div>'}l++}i=h!=null?'"NewRec":0,"id":'+h+",":'"NewRec":1,';i+='"Source":"'+(d.Source?d.Source:d.tblUpdate)+'","tblUpdate":"'+d.tblUpdate+'"';return"<div id='divEditableForm' class='inputform' style='margin:0 2em;' data-ctrl='{"+i+"}'>"+f+"</div>"};return m}();this.clsEditInPlaceForm=function(){var m,k,d;d={};m={Fields:[],Data:[],id:0,DataTable:""};k=function(a,g,n,o,e){a=
null;e=e!=null?e:{};$.extend(e,{"U\u017edaryti":function(){d.fnFieldsUpdatedCallBack&&m.Data&&d.fnFieldsUpdatedCallBack(m);return $(this).remove()}});$("<div id='divDialogForm' style='overflow:auto'></div>").html(g).ModifyDoom({tblProp:n,EditableFormId:o},m,d.fnUpdateSuccess).dialog({autoOpen:false,position:["center",50],resize:"auto",minWidth:"45em",width:"65em"}).dialog("open").css("height","auto");if(d.Grid)return a=$("#"+d.Grid.DoomId).clsGrid(d.Grid.Opt,d.Grid.Source)};return function(a){$("body").addClass("wait");
d=a;$.post(d.url,d.postPars,function(g){var n;for(n in g)n!=="Render"&&n!=="Script"&&oDATA.Set(n,g[n]);g.Script&&g.Script.File&&$.getScript(g.Script.File);g.Render?k(d.formTitle,g.Render,d.tblProp,d.EditableFormId,d.Buttons):alert("clsEditInPlaceForm nera Render objekto!");return $("body").removeClass("wait")})}}();$.fn.ModifyDoom=function(m,k,d){var a,g;g=this.find("#"+m.EditableFormId);a=eval("("+g.attr("data-ctrl")+")");k.id=a.id;k.DataTable=a.tblUpdate;g.find("div.EditInPlace, span.EditInPlace").each(function(){return $(this).MyEditInPlace({id:a.id,
tblUpdate:a.tblUpdate,tblProp:m.tblProp,DataToSave:k,fnUpdateSuccess:d})});return this};$.fn.MyEditInPlace=function(m){var k,d,a,g,n,o;g=$(this);k=g.html();(a=typeof g.data("ctrl")==="object"?g.data("ctrl"):eval("("+g.attr("data-ctrl")+")"))||(a={});$.extend(a,m,{FName:a.Field});if(m.tblProp){o=oDATA.Get(m.tblProp);d=o.Cols.FNameIndex(a.Field);a=$.extend({},o.Cols[d],a);$.extend(a,{Title:o.Grid.aoColumns[d].sTitle})}n=function(e,b){g.html('<img src="/Content/images/ajax-loader.gif" alt='+e+">");return $.post("/Update/editInPlace",
{id:a.id,tbl:a.tblUpdate,update_value:e,field:a.Field,show_value:b},function(c){if(c.ErrorMsg){Alert(c.ErrorMsg,"Klaida i\u0161saugant duomenis");return g.html(k)}else{g.html(c.ResponseMsg);k=c.ResponseMsg;if(m.DataToSave){m.DataToSave.Data.push(c.ResponseMsg);m.DataToSave.Fields.push(a.Field)}if(m.fnUpdateSuccess)return m.fnUpdateSuccess({ctrl:g,eOpt:a,id:a.id})}})};d={didOpenEditInPlace:function(e){var b;e.attr("width",e.width());b=e.width()<200?200:e.width();return e.find("textarea, input").width(b)}};
if(a.List)d.shouldOpenEditInPlace=function(e){var b;if(e.find("input").length>0)return false;b=oCONTROLS.txt({data_ctrl:JSON.stringify($.extend(a.List,{FName:a.FName})),classes:"ui-widget-content ui-corner-all",text:e.html(),Value:e.html()});e.html(b).find("input").ComboBox({fnValueChanged:function(c,h){return n(c,h)}}).focus().bind("blur",function(){var c;return c=setInterval(function(){var h;h=$("ul.ui-autocomplete").css("display");if(h==="none"||h===void 0){g.html(k);return clearInterval(c)}},
3E3)});return false};else if(a.Plugin)d.shouldOpenEditInPlace=function(e){var b,c,h,i;if(e.find("input").length>0)return false;e.html("<input type='text'></input>");h=e.find("input");h.val(k);i=a.Plugin;for(b in i){c=i[b];if(b==="datepicker"){$.extend(c,{onClose:function(j){return n(j,null)}});h.attr("readonly","readonly")[b](c).focus()}else b==="mask"&&h[b](c).focus().bind("blur",function(j){return(j=$(j.target).mask("value"))&&j!==k?n(j,null):e.empty().html(k)})}return false};if(!a.id||!a.tblUpdate||
!a.Field)alert("N\u0117ra privalom\u0173 duomen\u0173 (id, tblUpdate, Field)-clsEditableForm");$.extend(a,{delegate:d,callback:function(e,b){n(b,null);return'<img src="/Content/images/ajax-loader.gif" alt='+b+">"}});g.editInPlace(a);a.Title&&g.qtip({position:{at:"top center",my:"bottom center"},content:a.Title});return g}}).call(this);

(function(){var b;b=jQuery;b.fn.ButtonStatuses=function(a){var c;a=b.extend({},b.fn.ButtonStatuses.default_options,a);c=b(this).find("button").qtip({content:a.tip[a.StatusID],position:{at:"top center",my:"bottom center"}}).button({icons:a.iconOpt[a.StatusID]});if(a.enableEvents)return c.click({btn:c},function(d){if(a.StatusID>3)Alert("Sutartis jau sutvarkyta","Jeigu yra klausim\u0173 kreipkit\u0117s pas administracij\u012f");else return Confirm(a.question[a.StatusID],"Spauskite 'Gerai' jei sutinkate, 'At\u0161aukti' jei ne",
function(e){if(e){a.StatusID++;d.data.btn.qtip({content:a.tip[a.StatusID],position:{at:"top center",my:"bottom center"}}).button({icons:a.iconOpt[a.StatusID]});return oDATA.UpdateCell(a.tblSource,a.tblUpdate,a.ID,a.FieldName,a.StatusID)}})})};b.extend(b.fn.ButtonStatuses,{default_options:{iconOpt:[{},{primary:"img16-tag_red"},{primary:"img16-tag_yellow"},{primary:"img16-tag_green"},{primary:"img16-tag_green",secondary:"img16-check"}],tip:["","Nauja sutartis.<br /> Patvirtiniti sutart\u012f?","Patvirtinta sutartis.<br /> \u012ejungti paslaugas?",
"Paslaugos \u012fjungtos.<br /> Perkelti prie sutvarkyt\u0173?","Suartis sutvarkyta. Joki\u0173 kit\u0173 veiksm\u0173<br /> su \u0161ia sutartimi nereikia."],question:["","Ar patvirtinate sutarties \u012fsigaliojim\u012f?","Ar \u012fjungtos paslaugos pagal sutart\u012f?","Ar gauti visi dokumentai ir sutartis sutvarkyta?"],enableEvents:false}});this.clsUserData=function(){function a(){c=b("#header").data("user");b("#header").attr("data-user","");typeof c!=="object"&&alert("No user object")}var c;
c="";a.prototype.Id=function(){return c.Id};a.prototype.Name=function(){return c.Name};a.prototype.Email=function(){return c.Email};return a}();b(function(){return window.UserData=new clsUserData})}).call(this);

/// <reference path="../Plugins/jquery-1.6.2-vsdoc.js" />
(function($) {
   $.fn.extend({
      //pass the options variable to the function
      ValidateOnBlur: function(options) {
         //Set the default values, use comma to separate the settings, example:
         var defaults={
            ValidArray: [],
            Allow: 'Integer', //Decimal Date Time DateCtrl DateNotLessCtrl DateNotMoreCtrl  //Sutampa su nurodymais oDATA.SD.Cols[i].Type
            Trim: true
         }
         var opt=$.extend(defaults, options);
         //Jei turi but array, jo opcija ValidArray
         //ValidateOnBlur({ Allow: 'Integer' })
         //ValidateOnBlur({ Allow: 'Decimal' })
         return this.each(function() {
            var t=$(this);
            t.blur(function() {
               var inputVal=t.val();
               var re=/^(\s*)([\W\w]*)(\b\s*$)/;
               if(re.test(inputVal)) {
                  inputVal=inputVal.replace(re, '$2');
               } //remove leading and trailing whitespace characters
               if(opt.ValidArray.length) {
                  var idx=jQuery.inArray(inputVal, ValidArray); if(idx=== -1) { t.val(""); return; }
               }
               else if(opt.Allow==='Integer') {
                  re=/\D*(\d+)\D*/; if(re.test(inputVal)) inputVal=inputVal.replace(re, "$1"); else { t.val(""); return; }
               }
               else if(opt.Allow==='Decimal') {
                  inputVal=inputVal.replace(',', '.'); //re=/.*?(([0-9]?\.)?[0-9]+).*/g;
                  re=/\D*(\d\d*\.\d+|\d+)\D*/;
                  if(re.test(inputVal))
                     inputVal=inputVal.replace(re, "$1");
                  else { t.val(""); return; }
               }
               else if(opt.Allow==='Date'||opt.Allow==='DateCtrl'||opt.Allow==='DateNotLessCtrl'||opt.Allow==='DateNotMoreCtrl') {
                  inputVal=inputVal.replace('.', '-').replace('/', '-').replace('\\', '-');
                  re=/\.*((19|20\d{2})-([0]?[1-9]|[1][0-2])-([0-2][1-9]|3[0-1]|\d))+\.*/;
                  if(re.test(inputVal))
                     inputVal=inputVal.replace(re, "$1");
                  if(oVALIDATE.IsNumeric(inputVal)&&opt.Allow==='DateNotMoreCtrl') { if((parseInt(inputVal, 10))>=((new Date()).getFullYear())) { inputVal=((new Date()).getFullYear()); } }
                  if(oVALIDATE.IsNumeric(inputVal)&&opt.Allow==='DateNotLessCtrl') { if((parseInt(inputVal, 10))<=((new Date()).getFullYear())) { inputVal=((new Date()).getFullYear()); } }
                  else { t.val(""); return; }
               }
               else if(opt.Allow==='Year'||opt.Allow==='YearNotMore'||opt.Allow==='YearNotLess') {
                  inputVal=inputVal.replace('.', '-').replace('/', '-').replace('\\', '-');
                  re=/\.*(19|20\d{2})\.*/;
                  if(re.test(inputVal)) inputVal=inputVal.replace(re, "$1");
                  if(oVALIDATE.IsNumeric(inputVal)&&opt.Allow==='YearNotMore') { if((parseInt(inputVal, 10))>=((new Date()).getFullYear())) { inputVal=((new Date()).getFullYear()); } }
                  if(oVALIDATE.IsNumeric(inputVal)&&opt.Allow==='YearNotLess') { if((parseInt(inputVal, 10))<=((new Date()).getFullYear())) { inputVal=((new Date()).getFullYear()); } }
                  else { t.val(""); return; }
               }
               // \.*(19|20\d{2})\.*
               //\.*((19|20\d{2})[./-]([0]?[1-9]|[1][0-2])[./-]([0-2][1-9]|3[0-1]|\d))+\.*
               t.val(inputVal);
            });
         });
      }
   });
})(jQuery);
/* Lithuanian (UTF-8) initialisation for the jQuery UI date picker plugin. */
/* @author Arturas Paleicikas <arturas@avalon.lt> */
jQuery(function($) {
   $.datepicker.regional['lt']={
      closeText: 'Uždaryti',
      prevText: '&#x3c;Atgal',
      nextText: 'Pirmyn&#x3e;',
      currentText: 'Šiandien',
      monthNames: ['Sausis', 'Vasaris', 'Kovas', 'Balandis', 'Gegužė', 'Birželis',
                'Liepa', 'Rugpjūtis', 'Rugsėjis', 'Spalis', 'Lapkritis', 'Gruodis'],
      monthNamesShort: ['Sau', 'Vas', 'Kov', 'Bal', 'Geg', 'Bir',
                'Lie', 'Rugp', 'Rugs', 'Spa', 'Lap', 'Gru'],
      dayNames: ['sekmadienis', 'pirmadienis', 'antradienis', 'trečiadienis', 'ketvirtadienis', 'penktadienis', 'šeštadienis'],
      dayNamesShort: ['sek', 'pir', 'ant', 'tre', 'ket', 'pen', 'šeš'],
      dayNamesMin: ['Se', 'Pr', 'An', 'Tr', 'Ke', 'Pe', 'Še'],
      weekHeader: 'Sv',
      //dateFormat: 'yy-mm-dd',
      firstDay: 1,
      isRTL: false,
      showMonthAfterYear: false,
      yearSuffix: '',
      dateFormat: 'yy-mm-dd',
      changeMonth: true,
      showOtherMonths: true,
      selectOtherMonths: true
      //showWeek: true
   };
   $.datepicker.setDefaults($.datepicker.regional['lt'], { duration: 'fast' });
});
/**/
(function($) {
   $.fn.extend({
      swfUpload: function(options) {
         //privalomi duomenys: {RecId:??,UserId:??,tblUpdate:"tblContracts",url:??}
         var defaults={
            Title: "Pridėti bylas prie sutarties",
            Description: true,
            Legend: "Opa"
         }
         var opt=$.extend(defaults, options);
         return this.each(function() {
            var t=$(this);
            html=(opt.Legend)?"<fieldset><legend style='font-weight:bold;'>"+opt.Legend+"</legend>":"";
            html+=(opt.CtrlToSetId)?"<div id='"+opt.CtrlToSetId+"'></div>":"";
            html+='<div title="'+opt.Title+'" style="cursor:pointer;margin-left:2em;position:relative;clear:both;"><span style="display:inline-block;" class="img24-attach ui-button-icon-primary"></span><span style="position:absolute;margin:.3em 1em;text-decoration:underline;color:#336699">Prisegti bylas</span></div>';
            html+=(opt.Legend)?"</fieldset>":"";
            $(html)
            .find("div:last")
            .bind("click", function() {
               var opt=$(this).closest("div.ExtendIt, span.ExtendIt").data("ctrl");
               $.extend(opt, { Control: t });
               oCONTROLS.UploadDialog(opt,true);//2-ToDialog
            })
            .qtip({ position: { at: 'top center', my: 'bottom center'} })
            .end()
            .appendTo(t);
            oCONTROLS.UploadDialog.SetAttachedFiles(opt);//Prikabinam priatachintus failus
         });
      }
   });
})(jQuery);
oCONTROLS.UploadDialog=function(options,ToDialog) {
   var FileData=[];
   var defaults={
      upload_url: "/Files/AsyncUpload",
      DialogTitle: 'Bylų prisegimas prie dokumento',
   }
   var opt=$.extend(defaults, options);
   if(!opt.UserId||!opt.tblUpdate||!opt.RecId) { alert("swfUploaderis neturi vieno iš būtinų parametrų-UserId,tblUpdate,RecId!"); return; }
   var fnSetAttachedFiles=function(HaveData,ToDialog) {
      //var par={ RecordId: opt.RecId };
      var par=opt;
      if(HaveData) { $.extend(par, { HaveData: false }); }
      else { $.extend(par, { HaveData: true, FileData: FileData }); }
      //if(oDATA.Get(par.AttachedFiles)) {  }
      oCONTROLS.UploadDialog.SetAttachedFiles(par,ToDialog);
   }
   dlgOpt={ autoOpen: false, minWidth: '400', minHeight: '700', width: '700', modal: true, title: opt.DialogTitle,
      buttons: {
         "Išeiti": function() {
            return $(this).dialog("close");
         }
      },
      close: function() {
         if(opt.fnCallBack) { opt.fnCallBack(FileData); }
         if(opt.CtrlToSetId) { fnSetAttachedFiles(true,false); }
         //if(opt.refreshAction){$("#side-bar ul li a").filter("[data-action='"+opt.refreshAction+"']").data("opt","refresh")}
         return $(this).remove();
      }
   };
   //{RecId:??,UserId:??,tblUpdate:"tblContracts",url:??}
   $("#dialog:ui-dialog").dialog("destroy");
   _html="<div id='uplFiles'></div><div id='swfupload-control' style='clear:both;'><p style='font-size:medium;margin:.5em 0 1em 0;'>Pasirinkite norimas prisegti bylas. Galite pasirinkti iš karto daugiau bylų naudodami mygtukus SHIFT/ CTRL. Vienu metu pasirinkite ne daugiau 10MB.";
   _html+="</p><div><span id='dialog_file_upload_btn' ></span></div>";
   _html+="<p id='queuestatus' ></p><ol id='log'></ol></div>"
   $("<div id='divDialogForm'></div>").html(_html).dialog(dlgOpt).dialog('open');
   fnSetAttachedFiles((FileData.length>0)?true:false,true);//Sudedam failus i Dialoga
   $('#swfupload-control').swfupload({
      upload_url: opt.upload_url,
      post_params: {
         RecId: opt.RecId,
         UserId: opt.UserId,
         tblUpdate: opt.tblUpdate
      },
      file_post_name: 'uploadfile',
      file_size_limit: "10 MB",
      //file_types: "*.jpg;*.png;*.gif",
      //file_types_description: "Image files",
      file_upload_limit: 0,
      flash_url: "/Scripts/Plugins/swfupload.swf",
      //button_image_url: '/Content/Images/wdp_buttons_upload_114x29.png',
      button_width: 400,
      button_height: 40,
      button_cursor: SWFUpload.CURSOR.HAND,
      button_placeholder: $('#dialog_file_upload_btn')[0],
      button_text: "<span class='theStyle'>Spragtelėkite pasirinkti bylas esančias jūsų kompiuteryje</span>",
      button_text_style: '.theStyle {text-decoration:underline;color:#336699;font-size:14;}',
      debug: false
   })
      .bind('fileQueued', function(event, file) {
         var listitem='<li id="'+file.id+'" >'+
         'Byla: <em>'+file.name+'</em> ('+Math.round(file.size/1024)+' KB) <span class="progressvalue" ></span>'+
         '<div class="progressbar" ><div class="progress" ></div></div>'+
         '<p class="status" >Pending</p>'+
         '<span class="cancel" >&nbsp;</span>'+
         '</li>';
         $('#log').append(listitem);
         $('li#'+file.id+' .cancel').bind('click', function() { //Remove from queue on cancel click
            var swfu=$.swfupload.getInstance('#swfupload-control');
            swfu.cancelUpload(file.id);
            $('li#'+file.id).slideUp('fast');
         });
         // start the upload since it's queued
         $(this).swfupload('startUpload');
      })
      .bind('fileQueueError', function(event, file, errorCode, message) {
         alert('Failo '+file.name+' dydis per didelis - '+Math.round(file.size/1024)+' KB');
      })
      .bind('fileDialogComplete', function(event, numFilesSelected, numFilesQueued) {
         //$('#queuestatus').text('Files Selected: '+numFilesSelected+' / Queued Files: '+numFilesQueued);
         $('#queuestatus').text('Pasirinkta failų siuntimui: '+numFilesQueued).css('display', 'block');
      })
      .bind('uploadStart', function(event, file) {
         $('#log li#'+file.id).find('p.status').text('Uploading...');
         $('#log li#'+file.id).find('span.progressvalue').text('0%');
         $('#log li#'+file.id).find('span.cancel').hide();
      })
      .bind('uploadProgress', function(event, file, bytesLoaded) {
         //Show Progress
         var percentage=Math.round((bytesLoaded/file.size)*100);
         $('#log li#'+file.id).find('div.progress').css('width', percentage+'%');
         $('#log li#'+file.id).find('span.progressvalue').text(percentage+'%');
      })
      .bind('uploadSuccess', function(event, file, serverData) {
         var s=JSON.parse(serverData);
         var item=$('#log li#'+file.id);
         var fData=(opt.AttachedFiles)?oDATA.Get(opt.AttachedFiles).Data:0;
         item.find('div.progress').css('width', '100%');
         item.find('span.progressvalue').text('100%');
         if(s.FileId>0) {
            var NewFile=[s.FileId, opt.UserId, s.Date, Math.round(file.size/1024), file.name, opt.RecId, ''];
            FileData[FileData.length]=NewFile;
            if(fData) { fData[fData.length]=NewFile; }
            var type=(file.name.substring(file.name.search("\\."))).toLowerCase()
            var pathtofile='<a href="/Uploads/'+s.FileId+type+'" alt="'+file.name+'" target="_blank">Atidaryti &raquo;</a>';
            item.attr("title", "Prisegė - "+s.User+", "+s.Date).addClass('success').find('p.status').html('Baigta - '+Math.round(file.size/1024)+' KB | '+pathtofile);
            if(file.name.IsImage()) { item.qtip({ content: '<IMG WIDTH=200 HEIGHT=200 SRC="'+'/Uploads/'+s.FileId+type+'" ALT="'+file.name+'">', position: { at: 'top right', my: 'bottom left'} }) }
            //else { item.qtip({ position: { corner: { target: "bottomLeft"}} }); }
            else { item.qtip({ style: { tip: "bottomLeft"} }) }
         } else {
            item.addClass('error').find('p.status').html('Nepavyko - '+s.Msg);
         }
      })
      .bind('uploadComplete', function(event, file) {
         // upload has completed, try the next one in the queue
         $(this).swfupload('startUpload');
         //setTimeout(function() {
         //   $('#'+file.id).fadeOut(1000, CallBackAfterNoteRemove($('#'+file.id)));
         //}, 3000); //ikisama callbacka kai baigia
      })
   //   var CallBackAfterNoteRemove=function(e) {
   //      e.remove();
   //      if(!$('.success').length) { $('#queuestatus').css('display', 'none'); }
   //   }
};
oCONTROLS.UploadDialog.SetAttachedFiles=function(par,ToDialog) {
   //{FileData:(jei reikia filtruot iš AttachedFiles), RecId:??, CtrlToSetId:'uplFiles' arba i nurodyta,AttachedFiles: formatas kaip nurodyta zemiau}
   //0-FileId,User,Date-from server
   //3-SizeKB,FileName
   //5-RecId,Description
   //ctrl turi but Recordo ID
   //var f=par.AttachedFiles,
   var u=oDATA.Get("tblUsers").Data;
   var LeftOuter="<div style='clear:left;'><div style='margin-top:10px;height:46px;width:37px;float:left;'>";
   var RightOuter="</div><div style='height:46px;width:305px;float:left;'>";
   var RightInner="<div style='height:15px;width:304px;float:left;'>";
   var ctrl =((ToDialog)?$("#uplFiles"):$("#"+par.CtrlToSetId)).empty();
   $.post("/Files/GetUploads", { FileName: par.tblUpdate, RecordID: par.RecId }, function(jsRes) {
      var f=jsRes.Files.Data;
      for(var i=0; i<f.length; i++) {
         if(par.HaveData) { par.FileData[par.FileData.length]=f[i]; }
         var html=LeftOuter+f[i][4].GetIcon(f[i][0])+RightOuter+RightInner;  //icon,
         html+="Byla: <a href='/Files/Download/"+f[i][0]+"'>"+f[i][4]+", "+f[i][3]+"KB</a></div>"; //FileName, size
         html+=RightInner+"Įkėlė: "+u.findColsByID(f[i][1], [2, 3])+", "+f[i][2]+"</div>"; //vartotojas,data
         html+=RightInner+'<div style="width:100%;" '+((f[i][6])?'>':'class="inputTip">')+((f[i][6])?f[i][6]:"")+'</div></div></div></div>'; //Pastaba
         $(html).appendTo(ctrl).find('div:last').MyEditInPlace({ id: f[i][0], tblUpdate: "tblDocs_UploadedFiles", Field: "Description", default_text: "Spragtelkit pridėti pastabą..", Title: "Pastaba apie failą",
            fnUpdateSuccess: function(pars) { pars.ctrl.removeClass("inputTip"); } //$ctrl,eOpt[is opciju],id
         });
      }
      ctrl.find("span.img32-Img").each(function() {//rodom paveiksla ant imidzu
         var h=$(this).parent().attr("href");
         $(this).parent().qtip({
            content: '<IMG WIDTH=200 HEIGHT=200 SRC="'+h+'">', position: { at: 'top right', my: 'bottom left' }
         });
      });
   });
};
/// <reference path="../JSMain/jquery-1.6.2-vsdoc.js"
(function($) {
   $.widget("ui.ComboBox", {
      options: { ListType: "List", Editable: { Add: false, Edit: false }, iVal: 0, iText: [1], selectFirst: false, Value: "" },
      _create: function() {
         //surandam artimiausia inputa ant kurio desim listboxa
         //         if(this.element[0].nodeName==='INPUT') { var input=$(this.element[0]); }
         //         else {
         //            var t=this.element.parent().find('input')[0];
         //            if(t.nodeName==='INPUT') { var input=$(t); } else { alert('Error! Input not found for ComboBox! (MyPlugins_ComboBox:10)'); }
         //         }
         var input=$(this.element[0]); if(input===undefined) { alert('Error! Input not found for ComboBox! (MyPlugins_ComboBox:10)'); }
         var opt=$.extend(this.options, $(input).data("ctrl"));
         var fnEditItem=function(id) {
            new clsEditableForm({ objData: opt.Source, Action: (id)?"Edit":"Add", aRowData: (id)?oDATA.GetRow(id, opt.Source):0,
               CallBackAfter: function(RowData) {//Ikisam naujas val i newval, o teksta i inputa
                  $(input).data("newval", RowData[opt.iVal]); $(input).val(RowData.MapArrToString(opt.iText));
                  $(input).removeClass("inputTip");
                  var Action=(id)?"Edit":"Add";
                  if(Action==="Add") { data[data.length]=RowData.MapArrToString(opt.iText); }
                  else { data.UpdateArrToNew(RowData.MapArrToString(opt.iText)); }
               }
            })
         }
         //opt = $.extend({ ListType: "List", Editable: false, iVal: 0, iText: [1], selectFirst: false }, opt);     //ListType:{None(be nieko, galima spausdint), List(listas, spausdint negalima), Combo(Listas, spausdint galima)}
         var Editable=(opt.Editable.Add||opt.Editable.Edit)?true:false;
         var OptVal=parseInt(opt.Value,10), data=$.map(oDATA.Get(opt.Source).Data,
         function(a) {
            var ret=a.MapArrToString(opt.iText);
            //for(var i=0; i<opt.iText.length; i++) { { ret.push(a[opt.iText[i]]); } }
            if(a[0]===OptVal) { input.val(ret); } //Idedam verte i textboxa
            return { id: a[0], value: ret };
         });

         //if(typeof data!='undefined') { if(input.val()==='') { log('<p style="color:red;">Listas "'+opt.Source+'" nerado value:'+opt.Value+'</p>'); } }

         if(typeof opt.Append!=='undefined') { data[data.length]=opt.Append; } //Pridedam prie listo pvz: {Value:0, Text:"Neapdrausta"}
         $(input).data("newval", opt.Value)
         //.val(value)
   .autocomplete({
      selectFirst: opt.selectFirst, delay: 0, minLength: ((this.options.ListType==="None")?2:0), autoFocus: true,

      //      source: function(request, response) {
      //         response($.ui.autocomplete.filter(data, request.term));
      //      },
      //            source: function(request, response) {
      //               var matcher=new RegExp($.ui.autocomplete.escapeRegex(request.term), "i");
      //               response(Ul.children("a").map(function() {
      //                  var text=$(this).text();
      //                  if(this.value&&(!request.term||matcher.test(text)))
      //                     return {
      //                        label: text.replace(
      //            											new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(request.term)+")(?![^<>]*>)(?![^&;]+;)", "gi"), "<strong>$1</strong>"),
      //                        value: text,
      //                        option: this
      //                     };
      //               }));
      //            },
      //      source: function(request, response) {
      //         var matcher=new RegExp($.ui.autocomplete.escapeRegex(request.term), "i"), suggestions=[];
      //         input.removeClass('alink');
      //         $.each(data, function(i, a) {
      //            if(a.value&&(!request.term||matcher.test(a.value)))
      //            //suggestions.push({ label: text.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(request.term)+")(?![^<>]*>)(?![^&;]+;)", "gi"), "<strong>$1</strong>"),
      //            suggestions.push({ label: a.value,
      //               value: a.value, // option: this,
      //               id: a.id
      //            });
      //         });
      //         response(suggestions);
      //      },
      source: function(request, response) {
         response($.ui.autocomplete.filter(data, request.term));
      },

      select: function(event, ui) {
         if(ui.item) { $(this).data("newval", ui.item.id); } //Kad pamatyt pasikeitima  $(this).trigger('keypress');

         //alert("select:"+ui.item.value);
         //ui.item.value  -  "Neapdrausta"  --	$(this).val()
         //ui.item.option.value  -  "0"	--	$(this).data("newval")
         //console.log("Select:"+$(this).data("newval"));
      }, change: function(event, ui) {
         //Isimenam naujas reiksmes
         if(ui.item) {
            $(this).data("newval", ui.item.id);
            //console.log("New change:"+$(this).data("newval"));
         }
         else {
            $(this).data("newval", "");
            var t=$(this); t.data("newval", "");
            //Jei yra default text ji paliekam
            if(opt.Tip) { if(opt.Tip===t.val()) return true; }
            // remove invalid value, as it didn't match anything
            t.val("");
            if(typeof input.data("autocomplete")!='undefined') input.data("autocomplete").term="";
            t.removeClass('alink'); return false;
         } //console.log("New:"+$(this).attr("data-newval"));
      }, close: function() {
         //$(input).rem
         if(opt.Editable.Edit) { //linko pridėjimas
            var t=input, newVal=t.data("newval"); // (t.data("newval"))?t.data("newval").replace("0", ""):"";
            if(!t.hasClass('alink')&&newVal) { t.addClass('alink').unbind('dblclick').bind('dblclick', function() { fnEditItem(newVal); }) }
            else if(newVal) { t.unbind('dblclick').bind('dblclick', function() { fnEditItem(newVal); }) }
            else if(t.hasClass('alink')&&!newVal) { t.removeClass('alink').unbind('dblclick'); }
         }
         if(opt.ListType!=="List") { input.removeClass("activeField"); }
         if(opt.fnValueChanged&&input.data("newval")) { opt.fnValueChanged(input.data("newval"), input.val()); } //NewVal,NewText
      }, open: function() {
         if(opt.ListType!=="List") { if(!input.hasClass("activeField")) { input.addClass("activeField"); } }
         if(opt.ListType=="None"||opt.ListType=="Combo") {
            var acData=$(this).data('autocomplete');
            var termTemplate='<span style="color:red">%s</span>';
            acData.menu.element.find('a').each(function() {
               var me=$(this);
               var regex=new RegExp(acData.term, "gi");
               me.html(me.text().replace(regex, function(matched) {
                  return termTemplate.replace('%s', matched);
               }));
            });
         }
      }
   })
         //-----Inicializavimas pagal parametrus-------------------------------------------------------------------------------------
         if(opt.Editable.Edit) {
            var val=input.data("newval");
            if(val) { input.addClass('alink').bind('dblclick', function() { fnEditItem((val)?val:0); }); }
         }
         //---------------------------------------------------------------------------------------------------
         if(opt.ListType!=="None"||opt.Editable.Add) { input.removeClass("ui-corner-all").addClass("ui-corner-left"); } //ui-widget-content
         //pluginas AutoComplete Select first
         $(".ui-autocomplete-input").live("autocompleteopen", function() {
            var autocomplete=$(this).data("autocomplete"), menu=autocomplete.menu;
            if(!autocomplete.options.selectFirst) { return; }
            menu.activate($.Event({ type: "mouseenter" }), menu.element.children().first());
         });
         //---------------------------------------------------------------------------------------------------
         // This line added to set default value of the combobox
         $(input).data("autocomplete")._renderItem=function(ul, item) {
            return $("<li></li>").data("item.autocomplete", item).append("<a>"+item.value+"</a>").appendTo(ul);
         };
         if(opt.Editable.Add) {
            var id=$(this).data("newval"); id=(id)?id:0;
            this.addButton({ title: "Pridėti naują", icon: "img16-add_new",
               fn: function() {
                  fnEditItem(0);
               }, NoCorners: false
            }, input);
         };
         if(opt.ListType!="None") {
            this.addButton({ title: "Parodyti visus", icon: "ui-icon-triangle-1-s",
               fn: function() {
                  // close if already visible
                  if(input.autocomplete("widget").is(":visible")) { input.autocomplete("close"); return; }
                  // pass empty string as value to search for, displaying all results
                  input.autocomplete("search", ""); input.focus(); return false;
               }, NoCorners: ((opt.Editable.Add)?true:false)
            }, input);
            //input.focus(function() { input.autocomplete("search", ""); return false; }); //ant input focuso atidarom autocomplete
         };
         if(opt.ListType=="List") {
            input.attr("readonly", true);
            input.click(function() {
               if(input.autocomplete("widget").is(":visible")) { input.autocomplete("close"); return false; }
               input.autocomplete("search", ""); input.focus(); return false;
            }) //display all records
         } else {
            input.click(function() { this.select(); })
         }
      },
      addButton: function(p, input) {
         //title,icon,fn,NoCorners
         this.button=$("<button style='left:0;margin-left:.07em;'>&nbsp;</button>").attr("tabIndex", -1).attr("title", p.title).insertAfter(input)
                      .button({ icons: { primary: p.icon }, text: false }).css("vertical-align", "bottom").width(22).height(input.height()+3.8)
                      .click(function() { p.fn(); return false; })
                      .removeClass("ui-corner-all").addClass("ui-button-icon"+((p.NoCorners)?"":" ui-corner-right"))
                      .find('span.ui-icon').attr("style", "margin-left:0.1em;left:0;");
         input.width(input.width()-this.button.width());
      },
      destroy: function() {
         //input.remove();
         //if(typeof this.button!='undefined') this.button.remove(); //Reikia uncomentinti norint buttono
         //this.element.show();
         $.Widget.prototype.destroy.call(this);
      }
   });
})(jQuery);
